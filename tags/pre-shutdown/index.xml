<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Pre-Shutdown on</title><link>/tags/pre-shutdown/</link><description>Recent content in Pre-Shutdown on</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Mon, 09 Mar 2009 13:30:04 +0000</lastBuildDate><atom:link href="/tags/pre-shutdown/index.xml" rel="self" type="application/rss+xml"/><item><title>Shutdown Script For Asus WL-500W With Oleg Firmware</title><link>/2009/03/09/shutdown-script-asus-wl-500w-oleg-firmware/</link><pubDate>Mon, 09 Mar 2009 13:30:04 +0000</pubDate><guid>/2009/03/09/shutdown-script-asus-wl-500w-oleg-firmware/</guid><description>If you have an Asus WL-500W, the DIYers&amp;rsquo; favourite wireless router, and have installed the Oleg custom firmware on it, then you would have set up a shutdown script for it, that allows your router to shut down gracefully. This is especially important if you have a USB hard disk attached to it. There are many such scripts available in Oleg&amp;rsquo;s firmware that you can tweak. All of these reside in &amp;ldquo;/usr/local/sbin/&amp;rdquo;.</description><content>&lt;p>If you have an &lt;a href="http://tech.shantanugoel.com/tag/asus-wl-500w">Asus WL-500W&lt;/a>, the DIYers&amp;rsquo; favourite wireless router, and have installed the Oleg custom firmware on it, then you would have set up a shutdown script for it, that allows your router to shut down gracefully. This is especially important if you have a USB hard disk attached to it. There are many such scripts available in Oleg&amp;rsquo;s firmware that you can tweak. All of these reside in &amp;ldquo;/usr/local/sbin/&amp;rdquo;. The one that we are going to talk about today is named &amp;ldquo;pre-shutdown&amp;rdquo; and it is exceuted just before the router is about to shutdown. Here is my script that will stop all the programs that have been started, finalizes all data accesses for the hard drive, unmounts all the partitions and if they can&amp;rsquo;t be unmounted, then mounts them as read only to reduce the risks, and then allows the router to continue shutdown. Although this script is written for Asus WL-500W but it will work with most other routers that use oleg or unslung firmware (like Linksys NSLU2, Asus WL-500G, WL-500gP etc):&lt;/p>
&lt;pre tabindex="0">&lt;code>#! /bin/sh
/opt/etc/init.d/rc.unslung stop
sleep 5s
sync
sleep 5s
for i in `cat /proc/mounts | awk &amp;#39;/ext3/{print($1)}&amp;#39;` ; do
umount $i
if [ $? != 0 ] ; then
echo &amp;#34;Could not unmount $i. Mounting as read only&amp;#34;
mount -oremount,ro $i
else
echo &amp;#34;Unmount $i.&amp;#34;
fi
done
swapoff -a
sleep 1s
&lt;/code>&lt;/pre></content></item></channel></rss>