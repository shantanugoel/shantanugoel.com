<!doctype html><html lang=en><head><title>email-actions: An SMTP server that triggers actions from email :: </title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Releasing my project email-actions today. You install it from github or from pypi.
email-actions email-actions is a tiny SMTP server with a rules based engine to trigger any actions (notifications/commands etc) based on the emails sent to this server. Think of it like IFTTT but where input trigger is email and can be set up and run locally as well.
Why did you make email-actions Like most of my projects, email-actions is a &lsquo;scratch-your-own-itch&rsquo; project."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/2017/04/03/email-actions-trigger-tasks-from-email-smtp-server/><link rel=stylesheet href=/css/buttons.min.2bc533403a27dfe0e93105a92502b42ce4587e2e4a87d9f7d349e51e16e09478.css><link rel=stylesheet href=/css/code.min.00125962708925857e7b66dbc58391d55be1191a3d0ce2034de8c9cd2c481c36.css><link rel=stylesheet href=/css/fonts.min.90c955c31dd7c0e05aae3d4f583d4d8a2af799d69c961337eaf2a825063a55dd.css><link rel=stylesheet href=/css/footer.min.2e3eb191baee58dd05a9f0104ac1fab0827bca7c64dafe0b2579f934c33a1d69.css><link rel=stylesheet href=/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=/css/header.min.b6fb4423cf82a9f9d7abc9cd010223fa3d70a6526a3f28f8e17d814c06e18f9e.css><link rel=stylesheet href=/css/main.min.1d8be2dd1b5de9fdaed058c8c59fcf4485f36619574abfb47ed0cfda4812c16d.css><link rel=stylesheet href=/css/menu.min.83637a90d903026bc280d3f82f96ceb06c5fc72b7c1a8d686afb5bbf818a29f7.css><link rel=stylesheet href=/css/pagination.min.82f6400eae7c7c6dc3c866733c2ec0579e4089608fea69400ff85b3880aa0d3c.css><link rel=stylesheet href=/css/post.min.fc74ca360273c1d828da3c02b8174eba435607b369d98418ccc6f2243cd4e75d.css><link rel=stylesheet href=/css/prism.min.9023bbc24533d09e97a51a0a42a5a7bfe4c591ae167c5551fb1d2191d11977c0.css><link rel=stylesheet href=/css/syntax.min.cc789ed9377260d7949ea4c18781fc58959a89287210fe4edbff44ebfc1511b6.css><link rel=stylesheet href=/css/terminal.min.27a3af30c33c5e1d42bf51e61792cf1bd9390c0e57db917179413a769329355c.css><link rel=stylesheet href=/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel="shortcut icon" href=/favicon.png><link rel=apple-touch-icon href=/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="email-actions: An SMTP server that triggers actions from email"><meta property="og:description" content="Releasing my project email-actions today. You install it from github or from pypi.
email-actions email-actions is a tiny SMTP server with a rules based engine to trigger any actions (notifications/commands etc) based on the emails sent to this server. Think of it like IFTTT but where input trigger is email and can be set up and run locally as well.
Why did you make email-actions Like most of my projects, email-actions is a &lsquo;scratch-your-own-itch&rsquo; project."><meta property="og:url" content="/2017/04/03/email-actions-trigger-tasks-from-email-smtp-server/"><meta property="og:site_name" content><meta property="og:image" content="/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="Tinker"><meta property="article:published_time" content="2017-04-03 19:20:59 +0530 +0530"></head><body><div class=container><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Shantanu vs The World</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;‚ñæ</li><li><ul class=menu__dropdown><li><a href=https://x.com/shantanugoel/>üê§</a></li><li><a href=/>/blog</a></li><li><a href=/about>/about</a></li><li><a href=/archives>/archives</a></li><li><a href=/categories>/categories</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=https://x.com/shantanugoel/>üê§</a></li><li><a href=/>/blog</a></li><li><a href=/about>/about</a></li><li><a href=/archives>/archives</a></li><li><a href=/categories>/categories</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=/2017/04/03/email-actions-trigger-tasks-from-email-smtp-server/>email-actions: An SMTP server that triggers actions from email</a></h1><div class=post-meta><time class=post-date>2017-04-03</time><span class=post-author>Shantanu Goel</span></div><span class=post-tags>#<a href=/tags/python/>python</a>&nbsp;
#<a href=/tags/aiosmtpd/>aiosmtpd</a>&nbsp;
#<a href=/tags/email/>email</a>&nbsp;
#<a href=/tags/synology/>synology</a>&nbsp;
#<a href=/tags/download-station/>Download Station</a>&nbsp;</span><div class=post-content><div><p>Releasing my project <a href=https://github.com/shantanugoel/email-actions>email-actions</a> today. You install it from github or from pypi.</p><h1 id=email-actions>email-actions<a href=#email-actions class=hanchor arialabel=Anchor>#</a></h1><p>email-actions is a tiny SMTP server with a rules based engine to trigger any actions (notifications/commands etc) based on the emails sent to this server.
Think of it like <a href=https://ifttt.com>IFTTT</a> but where input trigger is email and can be set up and run locally as well.</p><h1 id=why-did-you-make-email-actions>Why did you make email-actions<a href=#why-did-you-make-email-actions class=hanchor arialabel=Anchor>#</a></h1><p>Like most of my projects, email-actions is a &lsquo;scratch-your-own-itch&rsquo; project. I bought a NAS (Synology ds216j) which also doubled as a downloader of anime/tv shows etc through RSS using its inbuilt &ldquo;Download Station&rdquo; app. I also used Plex to watch them over the network but these needed to be moved to a proper folder and named in a specific format (and some crap deleted and other maintenance done or sometimes some post processing done) to have Plex display/play them properly. I used Filebot and a few custom scripts for this but had to either do this manually or use a fixed time task scheduling (which tended to delay watching). This was semi-irritating.
I also wanted to know when something had been downloaded so I could binge on that latest episode as soon as it was done :)
Download station had a hack (by changing internal files) to run custom script after a download was completed but it had to be redone after every firmware update and sometimes, after every restart. And finally it stopped working altogether with recent updates.</p><p>It did support email notifications though. Thus email-actions was born. So I could push notifications for downloaded items run my custom scripts on the downloaded items.</p><p>Since then, I&rsquo;ve started using it for many other things as email is pervasive and most of the devices support email based notifications. So I can trap them and carry out other actions.</p><h1 id=what-are-the-benefitsdifferences-compared-to-hosted-services-like-ifttt>What are the benefits/differences compared to hosted services like IFTTT<a href=#what-are-the-benefitsdifferences-compared-to-hosted-services-like-ifttt class=hanchor arialabel=Anchor>#</a></h1><p>IFTTT provides email hooks as well. I <em>think</em> email-actions may be an alternative (you can decide whether it&rsquo;s better or not) with respect to below:</p><ul><li>IFTTT works as a client once email is received so you still need an available SMTP server to be able to send email. This can be expensive or risky as you&rsquo;d have to share your server username/pwd to the email sending entity. email-actions is an SMTP server that takes actions before any actual email delivery.</li><li>Can be run locally with minimal dependencies. You don&rsquo;t need to send your data to internet or even have an internet connection</li><li>Tiny footprint</li><li>Can run local commands as well while IFTTT still needs to be integrated with something else if that&rsquo;s what you need</li><li>You are in control of your info</li><li>Free(er), that is, no limitations on hooks/conditions etc</li></ul><h1 id=current-high-level-feature-list>Current high level feature list<a href=#current-high-level-feature-list class=hanchor arialabel=Anchor>#</a></h1><ul><li>aiosmtpd based for aync email processing for performance</li><li>The action execution is also asyncio based, so will free up the email sender while processing the action in background</li><li>Easy yaml based configuration</li><li>Global or local variables for full customization/reuse</li><li>Action decision based on &ldquo;To&rdquo; email address filtering (Addition of many other filters on the roadmap)</li><li>Plugins supported:<ul><li><a href=https://joaoapps.com/join/>Join</a> push notifications (Will add pushbullet if there&rsquo;s a demand or can use custom external script for now)</li><li>Custom Local commands (Any arguments, any script type, custom environment variables)</li><li>Email (Can forward the email to custom upstream servers further if needed for more actions or actual email delivery)</li></ul></li></ul><h1 id=installation>Installation<a href=#installation class=hanchor arialabel=Anchor>#</a></h1><p>Pre-requisites: You need Python 3.4+ to be able to run this</p><ul><li>Install using pip (May need to use <code>pip3</code> instead of <code>pip</code> according to your OS/python installation. May need to use <code>sudo</code> prefix before below command if installing system wide)</li></ul><p><code>pip install email-actions</code></p><ul><li>Install directly</li></ul><pre tabindex=0><code>git clone git@github.com:shantanugoel/email-actions.git
cd email-actions
python setup.py install
</code></pre><h1 id=usage>Usage<a href=#usage class=hanchor arialabel=Anchor>#</a></h1><pre tabindex=0><code>usage: email_actions [-h] [-v] [-H HOSTNAME] [-p PORT] [-l LOG] -c CONFIG

optional arguments:
  -h, --help            show this help message and exit
  -v, --version         show program&#39;s version number and exit
  -H HOSTNAME, --hostname HOSTNAME
                        Host IP or name to bind the server to
  -p PORT, --port PORT  Port number to bind the server to
  -l LOG, --log LOG     Set log level. 0=&gt; Warning, 1=&gt;Info, 2=&gt;Debug

required arguments:
  -c CONFIG, --config CONFIG
                        Specify config file (yaml format) to be used. If it
                        doesn&#39;t exist, we&#39;ll try to create it
</code></pre><p>Examples:</p><pre tabindex=0><code>email_actions -H 127.0.0.1 -p 8500 -l 2 -c /home/shantanu/email_actions_cfg.yml
</code></pre><pre tabindex=0><code>email_actions -c /home/shantanu/email_actions_cfg.yml
</code></pre><p>Most of the options above are self explanatory. If you don&rsquo;t specify a hostname, it will choose <code>localhost</code> by default. If you don&rsquo;t specify a port, it&rsquo;ll choose <code>8025</code> by default.</p><p><strong>Note</strong> I recommend running the server on localhost or an internal network interface so that it can&rsquo;t be abused from internet. Right now it doesn&rsquo;t support authentication (limitation of aiosmtpd. Will be fixed soon), so if you must open it up to the internet, add your own scheme of verification either through a randomly generated email address in &ldquo;To&rdquo; rule or some other check in subject/content in your own external script that you are triggering.</p><p>Specifying a config file is mandatory. If the specified file doesn&rsquo;t exist, we&rsquo;ll generate a dummy one which you can fill. But essentially this is a step that you can&rsquo;t avoid. The config file is explained in more detail below.</p><h2 id=config-file-format>Config file format<a href=#config-file-format class=hanchor arialabel=Anchor>#</a></h2><p>email-actions uses the simple <code>yaml</code> format for its configuration. Learning this is a small task (few minutes at most for the basic usage that we need). You can look at <a href=https://learn.getgrav.org/advanced/yaml>this page</a> for a quick reference.</p><p>email-actions works on the basis of user specified <code>filters</code>. Each filter can have <code>rules</code> specified which decide whether to run an action or not on the incoming email. Each filter also specifies <code>actions</code> (which is 1 or more plugins) to run an action on the incoming email if it passes the <code>rules</code>.</p><p>At least 1 filter is necessary in the configuration. Each filter must have at least 1 action. Rest all is optional. Each action plugin may have it&rsquo;s own mandatory OR optional settings. See <a href=#plugin-settings>Plugin Settings</a> for all available plugins and their options/variables</p><p>The config file has the following general format. All text after <code>#</code> is an explanation, not a part of the config itself.</p><p>Names within <code>&lt;></code> can be substituted by user as per their choice. Names outside <code>&lt;></code> are reserved by email-actions and must be used as is.</p><p>All settings are case-sensitive. So take care of that.</p><pre tabindex=0><code>global:  # Optional keyword that specifies global variables for plugins. These are available in all instances of your plugins in each filter
  &lt;plugin_name&gt;:  # Plugin name for which you are specifying a global variable
    &lt;setting_1&gt;: &lt;abcd&gt; # Variable/setting for this plugin.
    &lt;setting_2&gt;: &lt;efgh&gt; # Variable/setting for this plugin.

filters: #Mandatory keyword to signify start of your filters specifications.
  &lt;filter_name&gt;: # User specified name for a filter
    rules:       # Rules specifications start
      to: &lt;email_id&gt; # A rule that matches
</code></pre><p>Example: Take a look at the below sample config (Also found in <a href=https://github.com/shantanugoel/email-actions/blob/master/sample/config.yml>this location</a>)</p><pre tabindex=0><code># Specify a global variable for join plugin&#39;s api key
global:
  join:
    apikey: my_join_app_api_key

# Specify 2 filters.
# my_filter matches only the emails which are sent to abc@a.com and runs below 2 actions:
## Send join push notification using the global join api key
## Send an email using the credentials specified
# my_second_filter runs on all emails since there is no rule specified
# It runs below 2 actions:
## Send join notification using another_api_key. Local variable overrides the global one
## Run external command with given args and also sets up a environment variable called &#34;MY_ENV_VAR&#34; which can be accessed in external command

filters:
  my_filter:
    rules:
      to: abc@a.com
    actions:
      join:
      email:
        host: smtp.example.com
        username: my_email_username
        password: my_email_password
        port: 587
        secure: True
  my_second_filter:
      join:
        apikey: another_api_key
      exec:
        cmd: /home/shantanu/test.sh
        args:
          - /home/shantanu/abc_file
          - another_arg
        env:
          MY_ENV_VAR: &#39;Some Value&#39;
</code></pre><h2 id=rules>Rules<a href=#rules class=hanchor arialabel=Anchor>#</a></h2><p>Currently, below rules are supported. These can be specified under a <code>rules</code> block.</p><table><thead><tr><th>Rule Keyword</th><th>Value</th></tr></thead><tbody><tr><td>to</td><td>Any email id which should exactly match the &ldquo;To&rdquo; field in the incoming email</td></tr></tbody></table><h2 id=plugin-settings>Plugin Settings<a href=#plugin-settings class=hanchor arialabel=Anchor>#</a></h2><h3 id=join>join<a href=#join class=hanchor arialabel=Anchor>#</a></h3><p>This plugin sends a push notification to your devices using the <a href=https://joaoapps.com/join/>Join</a> app</p><p>Options:</p><table><thead><tr><th>Option Keyword</th><th>Mandatory / Optional</th><th>Default Value</th><th>Comment</th></tr></thead><tbody><tr><td>apikey</td><td>Mandatory</td><td>None</td><td>Your API key from <a href=https://joinjoaomgcd.appspot.com/>here</a></td></tr><tr><td>deviceId</td><td>Optional</td><td>group.all</td><td>See valid options <a href=https://joaoapps.com/join/api/>here</a></td></tr><tr><td>title</td><td>Optional</td><td>Email Subject</td><td>See valid options <a href=https://joaoapps.com/join/api/>here</a></td></tr><tr><td>text</td><td>Optional</td><td>Email content</td><td>See valid options <a href=https://joaoapps.com/join/api/>here</a></td></tr></tbody></table><h3 id=exec>exec<a href=#exec class=hanchor arialabel=Anchor>#</a></h3><p>This plugin allows to run any arbitrary command or script on your local system on which email-actions server is running.</p><table><thead><tr><th>Option Keyword</th><th>Mandatory / Optional</th><th>Default Value</th><th>Comment</th></tr></thead><tbody><tr><td>cmd</td><td>Mandatory</td><td>None</td><td>Full path to the command to be run. Don&rsquo;t include arguments. Enclose in quotes if space in path</td></tr><tr><td>args</td><td>Optional</td><td>Empty list</td><td>List of arguments to be passed to command, 1 on each line.</td></tr><tr><td>env</td><td>Optional</td><td>Empty dictionary</td><td>Key value pair of custom environment variables for the external command/script. One on each line</td></tr></tbody></table><h3 id=email>email<a href=#email class=hanchor arialabel=Anchor>#</a></h3><p>This plugin allows to forward the incoming email further to an upstream smtp server</p><table><thead><tr><th>Option Keyword</th><th>Mandatory / Optional</th><th>Default Value</th><th>Comment</th></tr></thead><tbody><tr><td>host</td><td>Mandatory</td><td>None</td><td>Provide hostname or ip of your upstream smtp server</td></tr><tr><td>port</td><td>Optional</td><td>25</td><td>Port for upstream smtp server</td></tr><tr><td>username</td><td>Optional</td><td>None</td><td>username if required</td></tr><tr><td>password</td><td>Optional</td><td>None</td><td>Password if required</td></tr><tr><td>secure</td><td>Optional</td><td>False</td><td>Set it to true if upstream server requires secure/TLS connection</td></tr></tbody></table><h1 id=contributing>Contributing<a href=#contributing class=hanchor arialabel=Anchor>#</a></h1><p>Feel free to fork the repo and send PRs for any changes. If you can&rsquo;t make changes but want to report issues or provide feedback, open an Issue on github or ping me on twitter <a href=https://twitter.com/shantanugoel>@shantanugoel</a></p><p>You can contribute either to the core or write a plugin for your usecase. The only guiding principle is to keep it as simple/minimal as possible.</p><h2 id=how-to-write-a-plugin>How to write a plugin<a href=#how-to-write-a-plugin class=hanchor arialabel=Anchor>#</a></h2><p>Take a look at any plugin in <a href=https://github.com/shantanugoel/email-actions/tree/master/email_actions/plugins>plugins</a> directory
A minimal plugin needs to do following things:</p><ul><li>Define &lsquo;PLUGIN_NAME&rsquo;. This need not be same as the file name but is preferred to keep that way</li><li>A function that takes these parameters: <code>filter_name, msg_from, msg_to, msg_subject, msg_content</code> and doesn&rsquo;t return anything</li><li>Read plugin&rsquo;s configuration (if any) using email_actions.config.read_config_plugin function<ul><li>Ideally the plugin should not need to use any other function from the core</li></ul></li><li>After writing the plugin, add the plugin&rsquo;s name and entry function in <code>entry_funcs</code> dict in <a href=https://github.com/shantanugoel/email-actions/tree/master/email_actions/plugins/__init__.py>plugins init file</a></li></ul></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>¬© 2024 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>