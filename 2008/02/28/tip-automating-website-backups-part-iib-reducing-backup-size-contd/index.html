<!doctype html><html lang=en><head><title>TIP: Automating Website Backups - Part IIb (Reducing Backup Size Contd.) :: Shantanu Vs The World</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Last time, I had told you about how to reduce the backup size. Well, this is a short note further developing on the approaches discussed there. Basically, telling tar to backup only those files which have changed. For this, Linux has a command â€œfindâ€ which I am very fond of. You can give it a option â€œ-newerâ€ followed by a fâ€filenameâ€ and it will return the names of the files that are newer than filename.
"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://shantanugoel.com/2008/02/28/tip-automating-website-backups-part-iib-reducing-backup-size-contd/><script async src="https://www.googletagmanager.com/gtag/js?id=G-5CKCTSFXW8"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5CKCTSFXW8")}</script><link rel=stylesheet href=https://shantanugoel.com/css/buttons.min.2bc533403a27dfe0e93105a92502b42ce4587e2e4a87d9f7d349e51e16e09478.css><link rel=stylesheet href=https://shantanugoel.com/css/code.min.00125962708925857e7b66dbc58391d55be1191a3d0ce2034de8c9cd2c481c36.css><link rel=stylesheet href=https://shantanugoel.com/css/fonts.min.4881f0c525f3ce2a1864fb6e96676396cebe1e6fcef1933e8e1dde7041004fb5.css><link rel=stylesheet href=https://shantanugoel.com/css/footer.min.2e3eb191baee58dd05a9f0104ac1fab0827bca7c64dafe0b2579f934c33a1d69.css><link rel=stylesheet href=https://shantanugoel.com/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://shantanugoel.com/css/header.min.b6fb4423cf82a9f9d7abc9cd010223fa3d70a6526a3f28f8e17d814c06e18f9e.css><link rel=stylesheet href=https://shantanugoel.com/css/main.min.fe8dc560fccb53a458b0db19ccb7b265764ac46b68596b7e099c6793054dd457.css><link rel=stylesheet href=https://shantanugoel.com/css/menu.min.83637a90d903026bc280d3f82f96ceb06c5fc72b7c1a8d686afb5bbf818a29f7.css><link rel=stylesheet href=https://shantanugoel.com/css/pagination.min.82f6400eae7c7c6dc3c866733c2ec0579e4089608fea69400ff85b3880aa0d3c.css><link rel=stylesheet href=https://shantanugoel.com/css/post.min.fc74ca360273c1d828da3c02b8174eba435607b369d98418ccc6f2243cd4e75d.css><link rel=stylesheet href=https://shantanugoel.com/css/prism.min.9023bbc24533d09e97a51a0a42a5a7bfe4c591ae167c5551fb1d2191d11977c0.css><link rel=stylesheet href=https://shantanugoel.com/css/syntax.min.cc789ed9377260d7949ea4c18781fc58959a89287210fe4edbff44ebfc1511b6.css><link rel=stylesheet href=https://shantanugoel.com/css/terminal.min.dd0bf9c7cacb24c1b0184f52f1869b274e06689557468cc7030ccf632328eb97.css><link rel=stylesheet href=https://shantanugoel.com/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel="shortcut icon" href=https://shantanugoel.com/favicon.png><link rel=apple-touch-icon href=https://shantanugoel.com/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content=" TIP: Automating Website Backups - Part IIb (Reducing Backup Size Contd.)"><meta property="og:description" content="Last time, I had told you about how to reduce the backup size. Well, this is a short note further developing on the approaches discussed there. Basically, telling tar to backup only those files which have changed. For this, Linux has a command â€œfindâ€ which I am very fond of. You can give it a option â€œ-newerâ€ followed by a fâ€filenameâ€ and it will return the names of the files that are newer than filename.
"><meta property="og:url" content="https://shantanugoel.com/2008/02/28/tip-automating-website-backups-part-iib-reducing-backup-size-contd/"><meta property="og:site_name" content="Shantanu Vs The World"><meta property="og:image" content="https://shantanugoel.com/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2008-02-28 04:00:00 +0000 UTC"></head><body><div class=container><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Shantanu vs The World</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;â–¾</li><li><ul class=menu__dropdown><li><a href=https://github.com/shantanugoel/>ğŸ’»</a></li><li><a href=https://x.com/shantanugoel/>ğŸ¤</a></li><li><a href=/>/blog</a></li><li><a href=/notes>/notes</a></li><li><a href=/about>/about</a></li><li><a href=/archives>/archives</a></li><li><a href=/fun>/fun</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=https://github.com/shantanugoel/>ğŸ’»</a></li><li><a href=https://x.com/shantanugoel/>ğŸ¤</a></li><li><a href=/>/blog</a></li><li><a href=/notes>/notes</a></li><li><a href=/about>/about</a></li><li><a href=/archives>/archives</a></li><li><a href=/fun>/fun</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://shantanugoel.com/2008/02/28/tip-automating-website-backups-part-iib-reducing-backup-size-contd/>TIP: Automating Website Backups - Part IIb (Reducing Backup Size Contd.)</a></h1><div class=post-meta><time class=post-date>2008-02-28</time><span class=post-author>Shantanu Goel</span></div><div class=post-content><div><p><a href=http://tech.shantanugoel.com/2008/02/25/tip-automating-website-backups-part-ii-reducing-backup-size.html>Last time</a>, I had told you about how to reduce the backup size. Well, this is a short note further developing on the approaches discussed there. Basically, telling tar to backup only those files which have changed. For this, Linux has a command â€œfindâ€ which I am very fond of. You can give it a option â€œ-newerâ€ followed by a fâ€<em>filename</em>â€ and it will return the names of the files that are newer than <em>filename</em>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>find ~ -type f -newer ~/backups/backup_x.tgz &gt; files.txt
</span></span></code></pre></div><p>So, the command given above will find all the files that have changed since you took the backup â€œ<em>backup_x.tgz</em>â€ and store those filenames and paths into â€œ_files.txtâ€. _The â€œ-type fâ€ option makes sure that only filenames are listed and not directory names, because tar creates a lot of issues when presented with directory names (Explore yourself about this).</p><p>Now, all we have to do is give this â€œ<em>files.txt</em>â€ to tar as an input to tell it which files to archive.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tar cvzpGf ~/backups/backup_$date.tgz -T files.txt
</span></span></code></pre></div><p>The â€œ-T files.txtâ€ option makes this happen. Moreover, I have introduced 2 new options here, that were not present in our last part. They are:</p><ul><li>p â€“ Tells tar to preserve file permissions</li><li>G â€“ Tells tar to ignore any file read errors etc and continue</li></ul><p>Apart from this, you can also take a look at the â€œ-mtime xâ€ option for find command which lets you specify to list files which have changed in past x days. There are other similar options available for find. Look at â€œman findâ€ and take your pick. Similar options exist for tar, but I have had a lot of weird issues using them, so Iâ€™d recommend sticking with this two step process of â€œfindâ€ followed by â€œtarâ€.</p><p>Now, the above mentioned commands and options can be used in innumerous ways and combinations to achieve your perfect balance of space and ease of use etc for backups. Iâ€™ll list down a sample script here, that will make a full backup on every first day of the week, and then make incremental backups over each day for rest 6 days. So, youâ€™ll save a lot of space (more than 5 times), but you will have to use all 7 backup files to make a full restore. (Iâ€™m listing just the backup part, you can add the â€œmuttâ€ command yourself, for e-mailing as mentioned in <a href=http://tech.shantanugoel.com/2008/02/17/tip-automating-website-backups.html>Part I</a>)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    date<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>date +%w<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> ! -e <span style=color:#e6db74>&#34;test/a&#34;</span> <span style=color:#f92672>]</span> <span style=color:#f92672>||</span> <span style=color:#f92672>[</span> -z <span style=color:#e6db74>&#34;</span>$date<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    tar cvzpGf ~/backups/backup_<span style=color:#e6db74>`</span>date +%w<span style=color:#e6db74>`</span>.tgz ~/public_html
</span></span><span style=display:flex><span>    echo inif
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    date2<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span>$date<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#66d9ef>))</span>
</span></span><span style=display:flex><span>    find ~ -type f -newer ~/backups/backup_$date2 &gt; files.txt
</span></span><span style=display:flex><span>    tar cvzpGf ~/backups/backup_$date.tgz -T files.txt
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><p>Thatâ€™s it for today. Lemme know if you have any doubts, or if you would like to see any other questions answered in this series. The question that will be answered next time is:</p><p>**Q2: **Cron? Using tar, making up the script file is enough command line for me. Isnâ€™t there an easy way?</p></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>Â© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>