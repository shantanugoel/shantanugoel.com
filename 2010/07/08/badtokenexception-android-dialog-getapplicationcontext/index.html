<!doctype html><html lang=en><head><title>BadTokenException Error In Android Dialog :: Shantanu Vs The World</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='If you are creating a custom Dialog for Android, and following the Android Developers‚Äô Creating Dialogs tutorial, then most likely you would have faced a Force Close with this exception showing up in logcat. I did too. Although I figured it out quickly, it might not be easy to find out for many, so posting it here for reference. Basically, the code given in the tutorial goes something like this:
Context mContext = getApplicationContext(); Dialog dialog = new Dialog(mContext); dialog.setContentView(R.layout.custom_dialog); dialog.setTitle("Custom Dialog"); TextView text = (TextView) dialog.findViewById(R.id.text); text.setText("Hello, this is a custom dialog!"); ImageView image = (ImageView) dialog.findViewById(R.id.image); image.setImageResource(R.drawable.android); All looks well, but when you execute it, you will get a Force Close. The error appearing in logcat would be something like this:
'><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://shantanugoel.com/2010/07/08/badtokenexception-android-dialog-getapplicationcontext/><link rel=stylesheet href=https://shantanugoel.com/css/buttons.min.2bc533403a27dfe0e93105a92502b42ce4587e2e4a87d9f7d349e51e16e09478.css><link rel=stylesheet href=https://shantanugoel.com/css/code.min.00125962708925857e7b66dbc58391d55be1191a3d0ce2034de8c9cd2c481c36.css><link rel=stylesheet href=https://shantanugoel.com/css/fonts.min.4881f0c525f3ce2a1864fb6e96676396cebe1e6fcef1933e8e1dde7041004fb5.css><link rel=stylesheet href=https://shantanugoel.com/css/footer.min.2e3eb191baee58dd05a9f0104ac1fab0827bca7c64dafe0b2579f934c33a1d69.css><link rel=stylesheet href=https://shantanugoel.com/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://shantanugoel.com/css/header.min.b6fb4423cf82a9f9d7abc9cd010223fa3d70a6526a3f28f8e17d814c06e18f9e.css><link rel=stylesheet href=https://shantanugoel.com/css/main.min.fe8dc560fccb53a458b0db19ccb7b265764ac46b68596b7e099c6793054dd457.css><link rel=stylesheet href=https://shantanugoel.com/css/menu.min.83637a90d903026bc280d3f82f96ceb06c5fc72b7c1a8d686afb5bbf818a29f7.css><link rel=stylesheet href=https://shantanugoel.com/css/pagination.min.82f6400eae7c7c6dc3c866733c2ec0579e4089608fea69400ff85b3880aa0d3c.css><link rel=stylesheet href=https://shantanugoel.com/css/post.min.fc74ca360273c1d828da3c02b8174eba435607b369d98418ccc6f2243cd4e75d.css><link rel=stylesheet href=https://shantanugoel.com/css/prism.min.9023bbc24533d09e97a51a0a42a5a7bfe4c591ae167c5551fb1d2191d11977c0.css><link rel=stylesheet href=https://shantanugoel.com/css/syntax.min.cc789ed9377260d7949ea4c18781fc58959a89287210fe4edbff44ebfc1511b6.css><link rel=stylesheet href=https://shantanugoel.com/css/terminal.min.dd0bf9c7cacb24c1b0184f52f1869b274e06689557468cc7030ccf632328eb97.css><link rel=stylesheet href=https://shantanugoel.com/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel="shortcut icon" href=https://shantanugoel.com/favicon.png><link rel=apple-touch-icon href=https://shantanugoel.com/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="BadTokenException Error In Android Dialog"><meta property="og:description" content='If you are creating a custom Dialog for Android, and following the Android Developers‚Äô Creating Dialogs tutorial, then most likely you would have faced a Force Close with this exception showing up in logcat. I did too. Although I figured it out quickly, it might not be easy to find out for many, so posting it here for reference. Basically, the code given in the tutorial goes something like this:
Context mContext = getApplicationContext(); Dialog dialog = new Dialog(mContext); dialog.setContentView(R.layout.custom_dialog); dialog.setTitle("Custom Dialog"); TextView text = (TextView) dialog.findViewById(R.id.text); text.setText("Hello, this is a custom dialog!"); ImageView image = (ImageView) dialog.findViewById(R.id.image); image.setImageResource(R.drawable.android); All looks well, but when you execute it, you will get a Force Close. The error appearing in logcat would be something like this:
'><meta property="og:url" content="https://shantanugoel.com/2010/07/08/badtokenexception-android-dialog-getapplicationcontext/"><meta property="og:site_name" content="Shantanu Vs The World"><meta property="og:image" content="https://shantanugoel.com/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="Code"><meta property="article:section" content="Mobile"><meta property="article:published_time" content="2010-07-08 11:24:14 +0000 UTC"></head><body><div class=container><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Shantanu vs The World</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;‚ñæ</li><li><ul class=menu__dropdown><li><a href=https://github.com/shantanugoel/>üíª</a></li><li><a href=https://x.com/shantanugoel/>üê§</a></li><li><a href=/>/blog</a></li><li><a href=/notes>/notes</a></li><li><a href=/about>/about</a></li><li><a href=/archives>/archives</a></li><li><a href=/categories>/categories</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=https://github.com/shantanugoel/>üíª</a></li><li><a href=https://x.com/shantanugoel/>üê§</a></li><li><a href=/>/blog</a></li><li><a href=/notes>/notes</a></li><li><a href=/about>/about</a></li><li><a href=/archives>/archives</a></li><li><a href=/categories>/categories</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://shantanugoel.com/2010/07/08/badtokenexception-android-dialog-getapplicationcontext/>BadTokenException Error In Android Dialog</a></h1><div class=post-meta><time class=post-date>2010-07-08</time><span class=post-author>Shantanu Goel</span></div><span class=post-tags>#<a href=https://shantanugoel.com/tags/android-dialogs/>Android Dialogs</a>&nbsp;
#<a href=https://shantanugoel.com/tags/badtokenexception-android/>BadTokenException Android</a>&nbsp;
#<a href=https://shantanugoel.com/tags/code/>Code</a>&nbsp;
#<a href=https://shantanugoel.com/tags/getapplicationcontext-android/>getApplicationContext Android</a>&nbsp;
#<a href=https://shantanugoel.com/tags/mobile/>Mobile</a>&nbsp;</span><div class=post-content><div><p>If you are creating a custom Dialog for Android, and following the <a href=http://developer.android.com/guide/topics/ui/dialogs.html>Android Developers‚Äô Creating Dialogs</a> tutorial, then most likely you would have faced a Force Close with this exception showing up in logcat. I did too. Although I figured it out quickly, it might not be easy to find out for many, so posting it here for reference. Basically, the code given in the tutorial goes something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Context mContext = getApplicationContext();       
</span></span><span style=display:flex><span>Dialog dialog = new Dialog(mContext); 
</span></span><span style=display:flex><span>dialog.setContentView(R.layout.custom_dialog);       
</span></span><span style=display:flex><span>dialog.setTitle(&#34;Custom Dialog&#34;); 
</span></span><span style=display:flex><span>TextView text = (TextView) dialog.findViewById(R.id.text);       
</span></span><span style=display:flex><span>text.setText(&#34;Hello, this is a custom dialog!&#34;);        
</span></span><span style=display:flex><span>ImageView image = (ImageView) dialog.findViewById(R.id.image);        
</span></span><span style=display:flex><span>image.setImageResource(R.drawable.android);
</span></span></code></pre></div><p>All looks well, but when you execute it, you will get a Force Close. The error appearing in logcat would be something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Uncaught handler: thread main exiting due to uncaught exception       
</span></span><span style=display:flex><span>android.view.WindowManager$BadTokenException: Unable to add window -- token null is not for an application
</span></span></code></pre></div><p>It isn‚Äôt apparent immediately that what is causing this error. The very first line in the code ‚ÄúContext mContext = getApplicationContext();‚Äù is the culprit.</p><p><strong>Solution:</strong> Just replace ‚ÄúgetApplicationContext()‚Äù with ‚Äúthis‚Äù (i.e. ‚ÄúContext mContext = this;‚Äù ) and it will work fine.</p><p><strong>Explanation:</strong> As to why this is exactly an issue, I‚Äôm a bit fuzzy about it myself but this much I‚Äôm sure that the contexts that you get with getApplicationContext and this are different. On reading about this function from Android SDK help:</p><blockquote><p>Return the context of the single, global Application object of the current process. This generally should only be used if you need a Context whose lifecycle is separate from the current context, that is tied to the lifetime of the process rather than the current component.</p></blockquote><p>I think this would mean is that getApplicationContext returns a context which is for the application itself and not the activity, while ‚Äúthis‚Äù would give you the context of the activity in which you are creating the dialog. I think since it is the activity which is associated with the UI (and for whom the window has been created), using the application context would have caused the crash here.</p></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>¬© 2024 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>